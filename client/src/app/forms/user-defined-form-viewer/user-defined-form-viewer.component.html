<!-- form header information and wrappers etc...-->

<form *ngIf="_form && formDef" clrForm [formGroup]="_form" clrLayout="horizontal"> <!-- TODO: conditional logic to determin layout-->
    <div *ngFor="let field of formDef.fields;">
        <div [ngSwitch]="field.type">
            <div *ngSwitchCase="'HIDDEN'">
                <input [formControlName]="field.key" type="hidden">
            </div>
            <div *ngSwitchCase="'TEXT'">
                <!-- <input [formControlName]="field.key"> -->
                <clr-input-container>
                    <label class="clr-control-label">{{ field.label }}{{ field.required ? '*' : '' }}</label>
                    <input clrInput type="text" [formControlName]="field.key" />
                    <clr-control-helper *ngIf="field.helperText">{{ field.helperText }}</clr-control-helper>
                    <clr-control-error *ngIf="_form.controls[field.key].errors">{{ _form.controls[field.key].errors }}</clr-control-error>
                </clr-input-container>
            </div>
            <div *ngSwitchCase="'NUMBER'">
                <!-- <input [formControlName]="field.key" type="number" [step]="field.step">TODO: if step id not defined will this cause an issue?-->
                <clr-input-container>
                    <label>{{ field.label }}{{ field.required ? '*' : '' }}</label>
                    <input clrInput type="number" [formControlName]="field.key"/> <!--  [step]="field.step" -->
                    <clr-control-helper *ngIf="field.helperText">{{ field.helperText }}</clr-control-helper>
                    <clr-control-error *ngIf="_form.controls[field.key].errors">{{ _form.controls[field.key].errors }}</clr-control-error>
                </clr-input-container>
            </div>
            <div *ngSwitchCase="'CHECK'">
                <!-- <input [formControlName]="field.key" type="number" [step]="field.step">TODO: if step id not defined will this cause an issue?-->
                <clr-checkbox-container>
                    <clr-checkbox-wrapper>
                        <label>{{ field.label }}{{ field.required ? '*' : '' }}</label>
                        <input clrCheckbox type="checkbox" [formControlName]="field.key"/> <!--  [step]="field.step" -->
                        <clr-control-helper *ngIf="field.helperText">{{ field.helperText }}</clr-control-helper>
                        <clr-control-error *ngIf="_form.controls[field.key].errors">{{ _form.controls[field.key].errors }}</clr-control-error>
                    </clr-checkbox-wrapper>
                </clr-checkbox-container>
            </div>
            <div *ngSwitchCase="'SELECT'">
                <clr-select-container>
                    <label>{{ field.label }}{{ field.required ? '*' : '' }}</label>
                    <select clrSelect [formControlName]="field.key">
                      <option *ngFor="let opt of castOptionsField(field).options.options" [value]="opt.value">{{ opt.display }}</option>
                    </select>
                    <clr-control-helper *ngIf="field.helperText">{{ field.helperText }}</clr-control-helper>
                    <clr-control-error *ngIf="_form.controls[field.key].errors">{{ _form.controls[field.key].errors }}</clr-control-error>
                  </clr-select-container>
            </div>
            <div *ngSwitchCase="'DATE'">
                <clr-date-container>
                    <label>{{ field.label }}{{ field.required ? '*' : '' }}</label>
                    <input type="date" [formControlName]="field.key" [clrDate]="newDate()" >
                    <clr-control-helper *ngIf="field.helperText">{{ field.helperText }}</clr-control-helper>
                    <clr-control-error *ngIf="_form.controls[field.key].errors">{{ _form.controls[field.key].errors }}</clr-control-error>
                </clr-date-container>
            </div>
            <div *ngSwitchCase="'NESTED'" style="padding-top: 10px">
                <label class="nested-label">{{ field.label }}{{ field.required ? '*' : '' }}</label>
                <app-master-detail-control [formControlName]="field.key" [innerForm]="castNestedField(field).innerForm" [templates]="templates"></app-master-detail-control>

                <clr-control-helper *ngIf="field.helperText">{{ field.helperText }}</clr-control-helper>
                <clr-control-error *ngIf="_form.controls[field.key].errors">{{ _form.controls[field.key].errors }}</clr-control-error>
            </div>

            <div *ngSwitchCase="'OBJECT_GRID'" style="padding-top: 10px">
                <label>{{ field.label }}{{ field.required ? '*' : '' }}</label>
                <app-object-grid-editor [formControlName]="field.key" [formDef]="castNestedField(field).formDef" [displayField]="castNestedField(field).displayField"></app-object-grid-editor>

                <clr-control-helper *ngIf="field.helperText">{{ field.helperText }}</clr-control-helper>
                <clr-control-error *ngIf="_form.controls[field.key].errors">{{ _form.controls[field.key].errors }}</clr-control-error>
            </div>
        </div>
    </div>
</form>

<button *ngIf="urlParams.has('debug')" class="btn btn-primary" (click)="printValue()">Print To Console</button>

<div *ngIf="urlParams.has('debug')">
    {{ Errors | json }}
</div>
